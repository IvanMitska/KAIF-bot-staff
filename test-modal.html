<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ - KAIF Staff</title>
    <link rel="stylesheet" href="webapp/public/styles.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <div class="container" style="padding: 20px;">
        <h1>üéØ –¢–µ—Å—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏</h1>

        <div style="margin-bottom: 30px;">
            <button onclick="testShowModal()" class="submit-btn" style="margin-right: 15px;">
                <i data-lucide="plus" class="btn-icon"></i>
                –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            </button>

            <button onclick="testCloseModal()" class="btn-secondary" style="margin-right: 15px;">
                <i data-lucide="x" class="btn-icon"></i>
                –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            </button>

            <button onclick="checkModalExistence()" class="btn-secondary">
                <i data-lucide="search" class="btn-icon"></i>
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DOM
            </button>
        </div>

        <div id="status" style="padding: 15px; background: var(--glass-white); border-radius: var(--radius-lg); margin-bottom: 20px;">
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="statusText">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</span></p>
        </div>

        <div style="background: var(--glass-white); padding: 20px; border-radius: var(--radius-lg);">
            <h3>–õ–æ–≥–∏:</h3>
            <div id="logs" style="font-family: monospace; font-size: 12px; line-height: 1.4; max-height: 200px; overflow-y: auto;">
                <div>üü¢ –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞</div>
            </div>
        </div>
    </div>

    <!-- –ö–æ–ø–∏—Ä—É–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ -->
    <div id="taskModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title-section">
                    <div class="modal-icon">
                        <i data-lucide="plus-circle"></i>
                    </div>
                    <h2 class="modal-title">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h2>
                </div>
                <button class="modal-close" onclick="testCloseModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <form id="taskForm" onsubmit="submitTask(event)" class="modern-form">
                <div class="form-group">
                    <label class="form-label">
                        <i data-lucide="user" class="label-icon"></i>
                        –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
                    </label>
                    <div class="custom-select-wrapper">
                        <select id="taskEmployee" name="employee" required class="custom-select">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</option>
                            <option value="ivan">Ivan</option>
                            <option value="anna">Anna</option>
                        </select>
                        <div class="select-arrow">
                            <i data-lucide="chevron-down"></i>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <i data-lucide="edit-3" class="label-icon"></i>
                        –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
                    </label>
                    <input type="text" name="title" required placeholder="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É" class="form-input">
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <i data-lucide="file-text" class="label-icon"></i>
                        –û–ø–∏—Å–∞–Ω–∏–µ <span class="optional-label">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span>
                    </label>
                    <textarea name="description" rows="4" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, —Å—Å—ã–ª–∫–∏..." class="form-textarea"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group half-width">
                        <label class="form-label">
                            <i data-lucide="calendar" class="label-icon"></i>
                            –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                        </label>
                        <input type="date" id="taskDeadline" name="deadline" required class="form-input">
                    </div>

                    <div class="form-group half-width">
                        <label class="form-label">
                            <i data-lucide="flag" class="label-icon"></i>
                            –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                        </label>
                        <div class="custom-select-wrapper">
                            <select name="priority" class="custom-select">
                                <option value="–ù–∏–∑–∫–∏–π">üü¢ –ù–∏–∑–∫–∏–π</option>
                                <option value="–°—Ä–µ–¥–Ω–∏–π" selected>üü° –°—Ä–µ–¥–Ω–∏–π</option>
                                <option value="–í—ã—Å–æ–∫–∏–π">üî¥ –í—ã—Å–æ–∫–∏–π</option>
                            </select>
                            <div class="select-arrow">
                                <i data-lucide="chevron-down"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" onclick="testCloseModal()" class="btn-secondary">
                        <i data-lucide="x"></i>
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="submit-btn">
                        <i data-lucide="plus" class="btn-icon"></i>
                        –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            log('üé® Lucide –∏–∫–æ–Ω–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ –∑–∞–≤—Ç—Ä–∞
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const dateInput = document.getElementById('taskDeadline');
            if (dateInput) {
                dateInput.value = tomorrow.toISOString().split('T')[0];
                log('üìÖ –î–∞—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: ' + dateInput.value);
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message) {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            logs.innerHTML += `<div>${time} - ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(text) {
            document.getElementById('statusText').textContent = text;
        }

        // –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function testShowModal() {
            log('üéØ –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ...');
            updateStatus('–û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ...');

            const modal = document.getElementById('taskModal');
            if (!modal) {
                log('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ taskModal –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ DOM');
                updateStatus('–û–®–ò–ë–ö–ê: –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                return;
            }

            log('‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞–π–¥–µ–Ω–æ –≤ DOM');

            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É
            window.scrollTo(0, 0);
            log('üìú –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–∞—á–∞–ª—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã');

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modal.style.display = 'flex';
            modal.classList.add('show');

            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏
            modal.style.opacity = '1';
            modal.style.visibility = 'visible';
            modal.style.pointerEvents = 'auto';

            // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.body.style.overflow = 'hidden';

            log('‚ú® –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–æ');
            updateStatus('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ');

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–∫–æ–Ω–∫–∏
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
                log('üé® –ò–∫–æ–Ω–∫–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
            }
        }

        // –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function testCloseModal() {
            log('üîí –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ...');
            updateStatus('–ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ...');

            const modal = document.getElementById('taskModal');
            if (!modal) {
                log('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                return;
            }

            modal.classList.remove('show');
            modal.style.opacity = '0';
            modal.style.visibility = 'hidden';
            modal.style.pointerEvents = 'none';

            setTimeout(() => {
                modal.style.display = 'none';
                log('üîí –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–∫—Ä—ã—Ç–æ');
            }, 300);

            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
            document.body.style.overflow = '';

            const form = document.getElementById('taskForm');
            if (form) {
                form.reset();
                log('üìù –§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞');
            }

            updateStatus('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã—Ç–æ');
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function checkModalExistence() {
            log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º DOM...');

            const modal = document.getElementById('taskModal');
            if (modal) {
                log('‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞–π–¥–µ–Ω–æ: ' + modal.tagName);
                log('üìä –¢–µ–∫—É—â–∏–π display: ' + getComputedStyle(modal).display);
                log('üìä –¢–µ–∫—É—â–∏–π opacity: ' + getComputedStyle(modal).opacity);
                log('üìä –¢–µ–∫—É—â–∏–π visibility: ' + getComputedStyle(modal).visibility);
                log('üìä –ö–ª–∞—Å—Å—ã: ' + modal.className);
                updateStatus('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ DOM');
            } else {
                log('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ù–ï –Ω–∞–π–¥–µ–Ω–æ –≤ DOM');
                updateStatus('–û–®–ò–ë–ö–ê: –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        function submitTask(event) {
            event.preventDefault();
            log('üìù –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)');
            updateStatus('–§–æ—Ä–º–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞');

            const formData = new FormData(event.target);
            log('üìã –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:');
            for (let [key, value] of formData.entries()) {
                log(`  ${key}: ${value}`);
            }

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
            setTimeout(() => {
                testCloseModal();
            }, 1000);
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('taskModal');
            if (event.target === modal) {
                log('üñ±Ô∏è –ö–ª–∏–∫ –ø–æ —Ñ–æ–Ω—É –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞');
                testCloseModal();
            }
        });
    </script>
</body>
</html>