require('dotenv').config();
const railwayService = require('./src/services/railwayOptimizedService');
const userService = require('./src/services/userService');

// –ó–∞–¥–∞—á–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
const missingTasks = [
  {
    title: "–ì–µ–Ω–µ—Ä–∞–ª—å–Ω–∞—è —É–±–æ—Ä–∫–∞",
    description: "–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—É—é —É–±–æ—Ä–∫—É –≤—Å–µ—Ö –∑–æ–Ω –∫–æ–º–ø–ª–µ–∫—Å–∞\n\n–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: –£–±–æ—Ä–∫–∞ / –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ",
    assigneeId: '1151085087', // –ù–∞–∑–Ω–∞—á–∞–µ–º –Ω–∞ –ö—Å–µ–Ω–∏—é –∫–∞–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∫–æ–º–ø–ª–µ–∫—Å–∞
    assigneeName: '–ö—Å–µ–Ω–∏—è',
    deadline: '2025-09-15',
    priority: '–í—ã—Å–æ–∫–∏–π'
  },
  // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏ —Å —Å–æ—Å—Ç–∞–≤–Ω—ã–º–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º–∏
  {
    title: "–ë–æ—á–∫–∏ —Å –≤–æ–¥–æ–π –¥–ª—è –æ–±–ª–∏–≤–Ω—ã—Ö (–ú–∞–∫—Å–∏–º)",
    description: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—á–∫–∏, –Ω–∞—Å–æ—Å, —á–∏–ª–ª–µ—Ä –∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç\n\n–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: –ë–∞–Ω—è / –¢–µ—Ö.–æ—Ç–¥–µ–ª\n–°–æ–≤–º–µ—Å—Ç–Ω–æ —Å –ë–æ—Ä–∏—Å–æ–º",
    assigneeId: '303267717', // –ú–∞–∫—Å–∏–º
    assigneeName: '–ú–∞–∫—Å–∏–º',
    deadline: '2025-09-21',
    priority: '–°—Ä–µ–¥–Ω–∏–π'
  },
  {
    title: "–£–±—Ä–∞—Ç—å —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –º—É—Å–æ—Ä (–ú–∞–∫—Å–∏–º)",
    description: "–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –æ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ —Å—Ç—Ä–æ–π–∫–∏\n\n–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: –£–±–æ—Ä–∫–∞ / –¢–µ—Ö.—Å–ª—É–∂–±–∞\n–°–æ–≤–º–µ—Å—Ç–Ω–æ —Å –ë–æ—Ä–∏—Å–æ–º",
    assigneeId: '303267717', // –ú–∞–∫—Å–∏–º
    assigneeName: '–ú–∞–∫—Å–∏–º',
    deadline: '2025-09-23',
    priority: '–í—ã—Å–æ–∫–∏–π'
  },
  {
    title: "–£–±—Ä–∞—Ç—å –Ω–µ–¥–µ–ª—å–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç (–ö—Å–µ–Ω–∏—è)",
    description: "–ò–∑—ä—è—Ç—å –Ω–µ–¥–µ–ª—å–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç –∏–∑ –ø—Ä–æ–¥–∞–∂–∏\n\n–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: –ü—Ä–æ–¥–∞–∂–∏ / CRM / IT\n–°–æ–≤–º–µ—Å—Ç–Ω–æ —Å –ë–æ—Ä–∏—Å–æ–º",
    assigneeId: '1151085087', // –ö—Å–µ–Ω–∏—è
    assigneeName: '–ö—Å–µ–Ω–∏—è',
    deadline: '2025-09-24',
    priority: '–°—Ä–µ–¥–Ω–∏–π'
  },
  {
    title: "–ü–∞—Ä–µ–Ω–∏—è –≤ —Ö–∞–º–∞–º–µ (–Æ—Ä–∏—Å—Ç)",
    description: "–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–µ–Ω–∏—è –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —Ö–∞–º–∞–º–µ —Å–æ —Å–∫–∏–¥–∫–æ–π\n\n–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: –ë–∞–Ω—è / –ü—Ä–æ–¥–∞–∂–∏\n–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ: –ö—Å–µ–Ω–∏—è + –Æ—Ä–∏—Å—Ç",
    assigneeId: '385436658', // –ë–æ—Ä–∏—Å –∫–∞–∫ —é—Ä–∏—Å—Ç
    assigneeName: '–ë–æ—Ä–∏—Å',
    deadline: '2025-09-12',
    priority: '–°—Ä–µ–¥–Ω–∏–π'
  },
  {
    title: "–†–µ–∫–ª–∞–º–∞ –ø–∞—Ä–µ–Ω–∏–π –Ω–∞ —Å—Ç–æ–ª–∞—Ö (–Æ—Ä–∏—Å—Ç)",
    description: "–†–∞–∑–º–µ—Å—Ç–∏—Ç—å —Ä–µ–∫–ª–∞–º—É –ø–∞—Ä–µ–Ω–∏–π –Ω–∞ —Å—Ç–æ–ª–∞—Ö –≤ –±–∞–Ω–µ\n\n–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ / –ë–∞–Ω—è\n–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ: –ö—Å–µ–Ω–∏—è + –Æ—Ä–∏—Å—Ç",
    assigneeId: '385436658', // –ë–æ—Ä–∏—Å –∫–∞–∫ —é—Ä–∏—Å—Ç
    assigneeName: '–ë–æ—Ä–∏—Å',
    deadline: '2025-09-13',
    priority: '–°—Ä–µ–¥–Ω–∏–π'
  },
  {
    title: "–ê–∫—Ü–∏–∏ –¥–ª—è –µ–≤—Ä–æ–ø–µ–π—Ü–µ–≤ (–ö—Å–µ–Ω–∏—è)",
    description: "–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ–º–æ (1+1 –∏ –¥—Ä.) –¥–ª—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω—Ü–µ–≤\n\n–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ / –ü—Ä–æ–¥–∞–∂–∏\n–°–æ–≤–º–µ—Å—Ç–Ω–æ —Å –ë–æ—Ä–∏—Å–æ–º",
    assigneeId: '1151085087', // –ö—Å–µ–Ω–∏—è
    assigneeName: '–ö—Å–µ–Ω–∏—è',
    deadline: '2025-09-16',
    priority: '–í—ã—Å–æ–∫–∏–π'
  },
  {
    title: "–ù–∞–≤–µ—Å—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –Ω–∞ —Å–∫–ª–∞–¥–µ (–î–º–∏—Ç—Ä–∏–π)",
    description: "–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–∞—Å—á–∏—Å—Ç–∫—É, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—é —Å–∫–ª–∞–¥–∞\n\n–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: –•–æ–∑.–æ—Ç–¥–µ–ª / –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ\n–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ: –ö—Å–µ–Ω–∏—è + –î–º–∏—Ç—Ä–∏–π + –ë–æ—Ä–∏—Å",
    assigneeId: '5937587032', // –î–º–∏—Ç—Ä–∏–π
    assigneeName: '–î–º–∏—Ç—Ä–∏–π',
    deadline: '2025-09-16',
    priority: '–°—Ä–µ–¥–Ω–∏–π'
  },
  {
    title: "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —à–∫–∞—Ñ—á–∏–∫–∏ –∏ –±—Ä–∞—Å–ª–µ—Ç—ã (–ú–∞–∫—Å–∏–º)",
    description: "–ü—Ä–∏–≤—è–∑–∞—Ç—å –±—Ä–∞—Å–ª–µ—Ç—ã –∫ —à–∫–∞—Ñ—á–∏–∫–∞–º, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å\n\n–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: IT / –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª\n–°–æ–≤–º–µ—Å—Ç–Ω–æ —Å –ò–≤–∞–Ω–æ–º",
    assigneeId: '303267717', // –ú–∞–∫—Å–∏–º
    assigneeName: '–ú–∞–∫—Å–∏–º',
    deadline: '2025-09-12',
    priority: '–í—ã—Å–æ–∫–∏–π'
  }
];

async function addMissingTasks() {
  try {
    console.log('üöÄ –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏...\n');
    
    await railwayService.initialize();
    
    let added = 0;
    let skipped = 0;
    
    // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–¥–∞—á–∏
    const existingTasks = await railwayService.getAllTasks();
    
    for (const task of missingTasks) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç
      const duplicate = existingTasks.find(t => 
        t.title === task.title && 
        t.assigneeId === task.assigneeId
      );
      
      if (duplicate) {
        console.log(`‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç: "${task.title}"`);
        skipped++;
        continue;
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const user = await userService.getUserByTelegramId(task.assigneeId);
      if (!user) {
        console.log(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω: ${task.assigneeName} (${task.assigneeId})`);
        skipped++;
        continue;
      }
      
      // –°–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á—É
      const taskData = {
        title: task.title,
        description: task.description,
        assigneeId: task.assigneeId,
        assigneeName: user.name,
        creatorId: '385436658', // Boris
        creatorName: '–ë–æ—Ä–∏—Å',
        priority: task.priority,
        deadline: task.deadline,
        status: '–ù–æ–≤–∞—è'
      };
      
      console.log(`üìù –°–æ–∑–¥–∞—é –∑–∞–¥–∞—á—É: "${task.title}" –¥–ª—è ${user.name}`);
      await railwayService.createTask(taskData);
      added++;
      console.log(`‚úÖ –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞\n`);
      
      // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
      await new Promise(resolve => setTimeout(resolve, 500));
    }
    
    console.log('\n' + '='.repeat(50));
    console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: ${added} –∑–∞–¥–∞—á`);
    console.log(`‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${skipped} –∑–∞–¥–∞—á`);
    console.log('='.repeat(50));
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error);
  } finally {
    process.exit(0);
  }
}

addMissingTasks();