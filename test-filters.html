<!DOCTYPE html>
<html>
<head>
    <title>Test Filters</title>
    <meta charset="UTF-8">
    <style>
        .filter-btn {
            padding: 10px 20px;
            margin: 5px;
            border: 1px solid #ccc;
            background: #f0f0f0;
            cursor: pointer;
        }
        .filter-btn.active {
            background: #007bff;
            color: white;
        }
        .task {
            padding: 10px;
            margin: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Тест фильтров задач</h1>
    
    <div>
        <button class="filter-btn active" onclick="filterTasks('all', event)">
            Все <span class="count">0</span>
        </button>
        <button class="filter-btn" onclick="filterTasks('new', event)">
            Новые <span class="count">0</span>
        </button>
        <button class="filter-btn" onclick="filterTasks('in-progress', event)">
            В работе <span class="count">0</span>
        </button>
        <button class="filter-btn" onclick="filterTasks('completed', event)">
            Выполнены <span class="count">0</span>
        </button>
    </div>
    
    <div id="tasksList"></div>
    
    <script>
        // Тестовые данные
        const testTasks = [
            { id: 1, title: 'Задача 1', status: 'Новая' },
            { id: 2, title: 'Задача 2', status: 'В работе' },
            { id: 3, title: 'Задача 3', status: 'Выполнена' },
            { id: 4, title: 'Задача 4', status: 'Новая' },
            { id: 5, title: 'Задача 5', status: 'В работе' },
            { id: 6, title: 'Задача 6', status: 'Выполнена' },
            { id: 7, title: 'Задача 7', status: 'Новая' }
        ];
        
        let currentFilter = 'all';
        let currentTasks = testTasks;
        
        function updateTaskCounts(tasks) {
            const counts = {
                all: tasks.length,
                new: tasks.filter(t => t.status === 'Новая').length,
                'in-progress': tasks.filter(t => t.status === 'В работе').length,
                completed: tasks.filter(t => t.status === 'Выполнена').length
            };
            
            console.log('Counts:', counts);
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                const onclickAttr = btn.getAttribute('onclick');
                if (onclickAttr) {
                    const match = onclickAttr.match(/filterTasks\('(.+?)'/);
                    if (match) {
                        const filter = match[1];
                        const countSpan = btn.querySelector('.count');
                        if (countSpan) {
                            countSpan.textContent = counts[filter] || 0;
                        }
                    }
                }
            });
        }
        
        function displayTasks(tasks) {
            const tasksList = document.getElementById('tasksList');
            
            // Фильтрация задач
            let filteredTasks = tasks;
            if (currentFilter !== 'all') {
                const statusMap = {
                    'new': 'Новая',
                    'in-progress': 'В работе',
                    'completed': 'Выполнена'
                };
                const targetStatus = statusMap[currentFilter];
                console.log('Filtering by status:', targetStatus);
                filteredTasks = tasks.filter(task => task.status === targetStatus);
            }
            
            console.log('Filtered tasks:', filteredTasks.length);
            
            if (filteredTasks.length === 0) {
                tasksList.innerHTML = '<p>Нет задач</p>';
                return;
            }
            
            tasksList.innerHTML = filteredTasks.map(task => {
                const color = task.status === 'Новая' ? 'red' : 
                            task.status === 'В работе' ? 'orange' : 'green';
                return `
                    <div class="task" style="border-left: 3px solid ${color}">
                        <strong>${task.title}</strong>
                        <span style="float: right; color: ${color}">${task.status}</span>
                    </div>
                `;
            }).join('');
        }
        
        function filterTasks(filter, event) {
            console.log('Filter clicked:', filter);
            currentFilter = filter;
            
            // Обновляем активную кнопку
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (event && event.target) {
                // Находим кнопку (может быть клик по span внутри кнопки)
                let button = event.target;
                if (button.tagName !== 'BUTTON') {
                    button = button.closest('button');
                }
                if (button) {
                    button.classList.add('active');
                }
            }
            
            // Отображаем отфильтрованные задачи
            displayTasks(currentTasks);
        }
        
        // Инициализация
        displayTasks(testTasks);
        updateTaskCounts(testTasks);
    </script>
</body>
</html>